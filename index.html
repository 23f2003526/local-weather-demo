<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>City Weather - Open-Meteo</title>
  <meta name="description" content="Simple weather dashboard for current conditions and a 3-day forecast using Open-Meteo." />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <style>
    :root{
      --card-max: 540px;
      --shadow: 0 0.25rem 0.75rem rgba(0,0,0,0.1);
      --muted: #6c757d;
    }
    html, body {
      background: #f8f9fa;
      min-height: 100%;
    }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }
    .weather-card {
      max-width: var(--card-max);
      width: 100%;
      padding: 1.25rem 1.25rem 1.5rem 1.25rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow);
      background: #fff;
    }
    .title-row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: .25rem;
    }
    h1 {
      font-size: 1.35rem;
      margin: 0;
      font-weight: 700;
    }
    .temp-toggle {
      user-select: none;
    }
    .temp-toggle .form-check {
      display: inline-flex;
      align-items: center;
      margin: 0 .5rem 0 0;
    }
    .temp-toggle input[type="radio"] {
      cursor: pointer;
    }
    .temp-toggle label {
      cursor: pointer;
      margin-left: .25rem;
      font-weight: 500;
    }
    .search-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: .5rem;
      margin-top: .75rem;
    }
    .muted {
      color: var(--muted);
      font-size: .9rem;
    }
    .section {
      margin-top: 1rem;
    }
    .current-wrap {
      display: flex;
      align-items: center;
      gap: .75rem;
    }
    .current-icon {
      font-size: 44px; /* emoji size */
      line-height: 1;
    }
    .current-main {
      flex: 1;
    }
    .current-temp {
      font-size: 2rem;
      font-weight: 700;
      margin: 0;
    }
    .small-row {
      display: flex;
      flex-wrap: wrap;
      gap: .75rem 1.25rem;
      margin-top: .25rem;
      color: var(--muted);
      font-size: .95rem;
    }
    .city-line {
      font-weight: 600;
    }
    .error-message {
      color: #dc3545;
      font-weight: 600;
      margin-top: .5rem;
    }
    .loading {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      color: var(--muted);
      font-size: .95rem;
    }
    .spinner {
      width: 1rem;
      height: 1rem;
      border: 2px solid #dee2e6;
      border-top-color: #6c757d;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .forecast-section h2 {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: .5rem;
    }
    .forecast-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    .forecast-table th,
    .forecast-table td {
      padding: 0.5rem;
      border: 1px solid #e9ecef;
      vertical-align: middle;
      font-size: 0.95rem;
      text-align: left;
    }
    .forecast-table th {
      background: #f1f3f5;
      font-weight: 700;
    }
    .ficon {
      font-size: 22px; /* emoji size for forecast */
      margin-right: .35rem;
      line-height: 1;
    }
    .footer-note {
      margin-top: .75rem;
      color: var(--muted);
      font-size: .85rem;
    }
    @media (max-width: 480px) {
      .current-temp { font-size: 1.75rem; }
      .current-icon { font-size: 40px; }
      .ficon { font-size: 20px; }
    }
  </style>
</head>
<body>
  <main class="weather-card">
    <div class="title-row">
      <h1>City Weather ‚Äî Open‚ÄëMeteo</h1>
      <div class="temp-toggle" role="group" aria-label="Temperature units">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="unit" id="unitC" value="C" checked />
          <label class="form-check-label" for="unitC">¬∞C</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="unit" id="unitF" value="F" />
          <label class="form-check-label" for="unitF">¬∞F</label>
        </div>
      </div>
    </div>

    <form id="searchForm" class="search-row" autocomplete="off" novalidate>
      <input id="cityInput" type="text" class="form-control" placeholder="Enter a city (e.g., London)" aria-label="City name" required />
      <button id="goBtn" type="submit" class="btn btn-primary">Get Weather</button>
    </form>
    <div id="status" class="muted" aria-live="polite"></div>
    <div id="error" class="error-message" role="alert" style="display:none;"></div>

    <section id="current" class="section" aria-live="polite"></section>

    <section id="forecast" class="section forecast-section"></section>

    <div class="footer-note">
      Data by Open‚ÄëMeteo (weather) and Open‚ÄëMeteo Geocoding. Client‚Äëside only; ideal for GitHub Pages.
    </div>
  </main>

  <script>
    (function() {
      const els = {
        form: document.getElementById('searchForm'),
        input: document.getElementById('cityInput'),
        status: document.getElementById('status'),
        error: document.getElementById('error'),
        current: document.getElementById('current'),
        forecast: document.getElementById('forecast'),
        unitC: document.getElementById('unitC'),
        unitF: document.getElementById('unitF'),
        goBtn: document.getElementById('goBtn'),
      };

      const state = {
        unit: 'C',
        place: null,   // { name, country, latitude, longitude, timezone }
        data: null     // raw Open-Meteo response
      };

      // Weather code to description (Open-Meteo WMO)
      function wmoDescription(code) {
        const groups = [
          [[0], 'Clear sky'],
          [[1], 'Mainly clear'],
          [[2], 'Partly cloudy'],
          [[3], 'Overcast'],
          [[45,48], 'Fog'],
          [[51,53,55], 'Drizzle'],
          [[56,57], 'Freezing drizzle'],
          [[61,63,65], 'Rain'],
          [[66,67], 'Freezing rain'],
          [[71,73,75], 'Snowfall'],
          [[77], 'Snow grains'],
          [[80,81,82], 'Rain showers'],
          [[85,86], 'Snow showers'],
          [[95], 'Thunderstorm'],
          [[96,99], 'Thunderstorm with hail']
        ];
        for (const [codes, text] of groups) {
          if (codes.includes(code)) return text;
        }
        return 'Unknown';
      }

      // Emoji icons for quick, dependency-free visuals
      function wmoEmoji(code, isDay) {
        if (code === 0) return isDay ? '‚òÄÔ∏è' : 'üåô';
        if ([1].includes(code)) return isDay ? 'üå§Ô∏è' : '‚òÅÔ∏è';
        if ([2].includes(code)) return isDay ? '‚õÖ' : '‚òÅÔ∏è';
        if ([3].includes(code)) return '‚òÅÔ∏è';
        if ([45,48].includes(code)) return 'üå´Ô∏è';
        if ([51,53,55,56,57].includes(code)) return 'üå¶Ô∏è';
        if ([61,63,65,66,67,80,81,82].includes(code)) return 'üåßÔ∏è';
        if ([71,73,75,77,85,86].includes(code)) return '‚ùÑÔ∏è';
        if ([95,96,99].includes(code)) return '‚õàÔ∏è';
        return 'üå°Ô∏è';
      }

      function toF(c) { return (c * 9/5) + 32; }
      function fmtTemp(c, unit = state.unit) {
        if (c == null || isNaN(c)) return '‚Äî';
        return unit === 'F' ? Math.round(toF(c)) + '¬∞F' : Math.round(c) + '¬∞C';
      }
      function fmtWind(ms) {
        // Open-Meteo returns wind_speed_10m in km/h if asked; default for current is km/h.
        // We will keep km/h as-is and label it.
        return (ms == null || isNaN(ms)) ? '‚Äî' : Math.round(ms) + ' km/h';
      }
      function formatDate(dStr, tz) {
        try {
          // dStr is ISO-like, already in requested timezone; display as weekday, day mon.
          const d = new Date(dStr);
          return d.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
        } catch {
          return dStr;
        }
      }
      function formatTime(dStr) {
        try {
          const d = new Date(dStr);
          return d.toLocaleString(undefined, { hour: '2-digit', minute: '2-digit' });
        } catch {
          return dStr;
        }
      }

      async function geocodeCity(name) {
        const url = new URL('https://geocoding-api.open-meteo.com/v1/search');
        url.searchParams.set('name', name);
        url.searchParams.set('count', '1');
        url.searchParams.set('language', 'en');
        url.searchParams.set('format', 'json');
        const res = await fetch(url.toString(), { headers: { 'Accept': 'application/json' } });
        if (!res.ok) throw new Error('Geocoding failed');
        const json = await res.json();
        if (!json.results || !json.results.length) {
          throw new Error('No matching city found');
        }
        const r = json.results[0];
        return {
          name: r.name,
          country: r.country_code || r.country || '',
          latitude: r.latitude,
          longitude: r.longitude,
          timezone: r.timezone || 'auto'
        };
      }

      async function fetchWeather(lat, lon, timezone = 'auto') {
        const url = new URL('https://api.open-meteo.com/v1/forecast');
        url.searchParams.set('latitude', lat);
        url.searchParams.set('longitude', lon);
        url.searchParams.set('timezone', timezone || 'auto');
        // current weather
        url.searchParams.set('current', 'temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m,is_day');
        // daily 4 days (today + next 3) so we can render 3-day forecast excluding today
        url.searchParams.set('daily', 'weather_code,temperature_2m_max,temperature_2m_min');
        url.searchParams.set('forecast_days', '4');
        const res = await fetch(url.toString(), { headers: { 'Accept': 'application/json' } });
        if (!res.ok) throw new Error('Weather request failed');
        return await res.json();
      }

      function clearMessages() {
        els.error.style.display = 'none';
        els.error.textContent = '';
        els.status.textContent = '';
      }

      function setLoading(isLoading) {
        if (isLoading) {
          els.status.innerHTML = '<span class="loading"><span class="spinner" aria-hidden="true"></span> Loading‚Ä¶</span>';
          els.goBtn.disabled = true;
        } else {
          els.status.textContent = '';
          els.goBtn.disabled = false;
        }
      }

      function renderCurrent() {
        els.current.innerHTML = '';
        if (!state.place || !state.data || !state.data.current) return;

        const c = state.data.current;
        const cityLine = document.createElement('div');
        cityLine.className = 'city-line';
        cityLine.textContent = `${state.place.name}${state.place.country ? ', ' + state.place.country : ''}`;

        const wrap = document.createElement('div');
        wrap.className = 'current-wrap';

        const icon = document.createElement('div');
        icon.className = 'current-icon';
        icon.textContent = wmoEmoji(c.weather_code, c.is_day === 1);

        const main = document.createElement('div');
        main.className = 'current-main';

        const temp = document.createElement('p');
        temp.className = 'current-temp';
        temp.textContent = fmtTemp(c.temperature_2m);

        const sub = document.createElement('div');
        sub.className = 'small-row';
        const desc = wmoDescription(c.weather_code);
        const timeStr = (c.time ? `${formatDate(c.time)} ${formatTime(c.time)}` : '');
        sub.innerHTML = `
          <span>${desc}</span>
          <span>Humidity: ${c.relative_humidity_2m != null ? c.relative_humidity_2m + '%' : '‚Äî'}</span>
          <span>Wind: ${fmtWind(c.wind_speed_10m)}</span>
          <span>${timeStr}</span>
        `;

        main.appendChild(temp);
        main.appendChild(sub);
        wrap.appendChild(icon);
        wrap.appendChild(main);

        els.current.appendChild(cityLine);
        els.current.appendChild(wrap);
      }

      function renderForecast() {
        els.forecast.innerHTML = '';
        if (!state.data || !state.data.daily) return;

        const d = state.data.daily;
        const dates = d.time || [];
        const wcodes = d.weather_code || [];
        const tmax = d.temperature_2m_max || [];
        const tmin = d.temperature_2m_min || [];

        // Exclude "today" (index 0), show next 3 days if available
        const rows = [];
        for (let i = 1; i < Math.min(dates.length, 4); i++) {
          rows.push({
            date: dates[i],
            code: wcodes[i],
            tmax: tmax[i],
            tmin: tmin[i]
          });
        }

        // If API doesn't return enough, gracefully handle
        const count = Math.min(rows.length, 3);

        const header = document.createElement('h2');
        header.textContent = '3‚ÄëDay Forecast';

        const table = document.createElement('table');
        table.className = 'forecast-table';
        table.setAttribute('aria-label', '3 day forecast');

        const thead = document.createElement('thead');
        thead.innerHTML = `
          <tr>
            <th style="width:40%;">Day</th>
            <th style="width:35%;">Conditions</th>
            <th style="width:25%;">Min / Max</th>
          </tr>
        `;
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        for (let i = 0; i < count; i++) {
          const r = rows[i];
          const tr = document.createElement('tr');
          const isDay = true; // daily icon - show a day icon for simplicity
          tr.innerHTML = `
            <td>${formatDate(r.date)}</td>
            <td><span class="ficon">${wmoEmoji(r.code, isDay)}</span>${wmoDescription(r.code)}</td>
            <td>${fmtTemp(r.tmin)} / ${fmtTemp(r.tmax)}</td>
          `;
          tbody.appendChild(tr);
        }
        table.appendChild(tbody);

        els.forecast.appendChild(header);
        els.forecast.appendChild(table);
      }

      function renderAll() {
        renderCurrent();
        renderForecast();
      }

      async function handleSearch(evt) {
        evt.preventDefault();
        clearMessages();
        const city = (els.input.value || '').trim();
        if (!city) {
          els.error.textContent = 'Please enter a city name.';
          els.error.style.display = 'block';
          return;
        }

        setLoading(true);
        try {
          const place = await geocodeCity(city);
          state.place = place;
          const data = await fetchWeather(place.latitude, place.longitude, place.timezone);
          state.data = data;

          els.status.textContent = '';
          els.error.style.display = 'none';

          renderAll();
          // cache last search for convenience
          try { localStorage.setItem('lastCity', place.name); } catch {}
        } catch (e) {
          els.error.textContent = e.message || 'Unable to fetch weather. Please try again.';
          els.error.style.display = 'block';
          els.current.innerHTML = '';
          els.forecast.innerHTML = '';
        } finally {
          setLoading(false);
        }
      }

      function handleUnitChange() {
        const newUnit = els.unitF.checked ? 'F' : 'C';
        if (state.unit !== newUnit) {
          state.unit = newUnit;
          renderAll();
        }
      }

      // Event listeners
      els.form.addEventListener('submit', handleSearch);
      els.unitC.addEventListener('change', handleUnitChange);
      els.unitF.addEventListener('change', handleUnitChange);

      // Restore last city if available
      try {
        const last = localStorage.getItem('lastCity');
        if (last) {
          els.input.value = last;
        }
      } catch {}

      // Friendly hint
      els.status.textContent = 'Tip: Try typing Paris, New York, or Tokyo.';
    })();
  </script>
</body>
</html>